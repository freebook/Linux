<?xml version="1.0" encoding="UTF-8"?>
<section id="container">
	<title>容器</title>
	<section>
		<title>查看容器</title>
		<screen>
		<![CDATA[
iMac:netkiller neo$ docker container ls		
		]]>
		</screen>
	</section>
	
	<section>
		<title>启动与终止容器</title>
		<screen>
			<![CDATA[
$ sudo docker run ubuntu:14.10 /bin/echo 'Hello world'
Hello world			
			]]>
		</screen>
		<para>进入BASH</para>
		<screen>
			<![CDATA[
$ sudo docker run -t -i ubuntu:14.10 /bin/bash
root@f8c7b2afff14:/# 			
			]]>
		</screen>
		<para>start / stop / restart</para>
		<screen>
			<![CDATA[
sudo docker start silly_bohr
silly_bohr

$ sudo docker stop silly_bohr
silly_bohr

$ sudo docker restart silly_bohr
silly_bohr
			]]>
		</screen>
		<screen>
		<![CDATA[
[root@localhost ~]# docker container start registry
registry

[root@localhost ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
f1e57592f82a        registry:latest     "/entrypoint.sh /etc…"   8 days ago          Up 6 seconds        0.0.0.0:5000->5000/tcp   registry		

[root@localhost ~]# curl http://192.168.3.6:5000/v2/_catalog
{"repositories":[]}
		]]>
		</screen>
		<para>守护进程运行</para>
		<screen>
			<![CDATA[
$ sudo docker run -d ubuntu:14.10 /bin/sh -c "while true; do echo hello world; sleep 1; done"
4cdbb75eeabf3f1ea87bec91accdf5211639d0895e94ab94ffa1d55fb7f62e2a
			]]>
		</screen>
		<para>通过 docker ps 命令来查看容器信息</para>
		<screen>
			<![CDATA[
$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
4cdbb75eeabf        ubuntu:14.10        "/bin/sh -c 'while t   30 seconds ago      Up 28 seconds                           drunk_rosalind 
			]]>
		</screen>
		<para>要获取容器的输出信息，可以通过 docker logs 命令。</para>
		<screen>
			<![CDATA[
$ sudo docker logs insane_babbage			
			]]>
		</screen>
		<para>注意：守护进程在后台运行，所以无输出，只能通过docker logs 命令查看</para>
	</section>
	<section>
		<title>进入容器</title>
		<screen>
			<![CDATA[
$ sudo docker run -idt ubuntu:14.10
793f9805620d7e10564e0778c388640cb73b6a1aec663bf468904d72a4f219f2

$ sudo docker ps 
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
793f9805620d        ubuntu:14.10        "/bin/bash"         5 seconds ago       Up 4 seconds                            mad_elion           

$ sudo docker attach mad_elion 
root@793f9805620d:/# ls
bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
			]]>
		</screen>
	</section>
	<section>
		<title>导出和导入容器</title>
		<section>
			<title>Ubuntu</title>
			<para></para>
			<screen>
			<![CDATA[
$ sudo docker export 7691a814370e > ubuntu.tar
			]]>
			</screen>
			<para></para>
			<screen>
			<![CDATA[
			<![CDATA[
$ cat ubuntu.tar | sudo docker import - test/ubuntu:v1.0
			]]>
			</screen>
			<para>指定 URL 或者某个目录来导入，例如</para>
			<screen>
			<![CDATA[
$sudo docker import http://example.com/exampleimage.tgz example/imagerepo			
			]]>
			</screen>
		</section>
		<section>
			<title>Mac 导出与导入</title>
			<para>导出</para>
			<screen>
		<![CDATA[
iMac:tmp neo$ docker export registry -o registry.tar		
		]]>
			</screen>
			<para>导入</para>
			<screen>
		<![CDATA[
iMac:tmp neo$ docker import registry.tar 
sha256:1678c838115696f9540f168fe117ea81715b6b676497307e65d15d1ac10d9a11
		]]>
			</screen>
			<para>指定 [REPOSITORY[:TAG]]</para>
			<screen>
		<![CDATA[
iMac:tmp neo$ docker import registry.tar registry:latest
sha256:7b76bd807a47dcc60e41bf2f8268ecf69906bb14c2ebaa348c4c15aac716b878

iMac:tmp neo$ docker images registry
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
registry            latest              7b76bd807a47        11 seconds ago      26.2MB		
		]]>
			</screen>
		</section>
	</section>
	<section id="kill">
		<title>停止所有容器</title>
		<para>杀死所有正在运行的容器</para>
		<screen>
			<![CDATA[
docker kill $(docker ps -a -q)			
			]]>
		</screen>
	</section>
	<section>
		<title>删除容器</title>
		<para>使用 docker rm 来删除一个处于终止状态的容器。</para>
		<screen>
			<![CDATA[
$ sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS                      PORTS               NAMES
f8c7b2afff14        ubuntu:14.10        "/bin/bash"            14 minutes ago      Exited (0) 2 minutes ago                        agitated_fermat     
0abd2e5fc251        ubuntu:14.10        "/bin/echo 'Hello wo   15 minutes ago      Exited (0) 15 minutes ago                       clever_kowalevski 

$ sudo docker rm clever_kowalevski
clever_kowalevski

$ sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
f8c7b2afff14        ubuntu:14.10        "/bin/bash"         16 minutes ago      Exited (0) 5 minutes ago                       agitated_fermat     			
			]]>
		</screen>
		<para></para>
		<screen>
			<![CDATA[
$ docker rm 719f98391ecf1d6f1f153ffea1bbd84cd2dc9cf6d31d5a4f348c60d98392814c
			]]>
		</screen>
		<para>删除所有已经停止的容器</para>
		<screen>
			<![CDATA[
docker rm $(docker ps -a -q)			
			]]>
		</screen>
	</section>
	<section>
		<title>向 /etc/hosts 文件内添加主机名</title>
		<screen>
		<![CDATA[
docker run -it --add-host=db.netkiller.cn:172.16.18.80 ubuntu cat /etc/hosts		
		]]>
		</screen>
	</section>
	<section>
		<title>设置环境变量</title>
		<screen>
		<![CDATA[
iMac:welcome neo$ docker run 127.0.0.1:5000/netkiller/welcome -e JAVA_OPTS="-server -Xms512m -Xmx4096m"		
		]]>
		</screen>
	</section>
</section>